<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>授業出席一覧</title>
    
    <link rel="stylesheet" th:href="@{/css/attendance_list.css}">
    </head>
<body>
    <header th:replace="~{base/header :: header}"></header>

    <main class="attendance-list-container">
        <h2>授業出席一覧</h2>

        <form id="attendanceSearchForm" action="/student/attendance" method="get" class="search-form">
            <label for="subject">授業名：</label>
            <select id="subject" name="subjectId">
                <option value="">すべて</option>
                <option th:each="s : ${subjects}" 
                        th:value="${s.subjectId}" 
                        th:text="${s.subjectName}">
                </option>
            </select>

            <label for="date">日付：</label>
            <input type="date" id="date" name="date" max="9999-12-31">

            <button type="submit">検索</button>
        </form>

        <section class="result-section">
            <h3>検索結果</h3>

            <table class="attendance-table" id="attendanceTable">
                <thead>
                    <tr>
                        <th>日付</th>
                        <th>授業名</th>
                        <th>受講人数</th> 
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="a : ${attendances}">
                        <th:block th:with="lessonKey=${a.subject.subjectId + '_' + #temporals.format(a.sessionDatetime,'yyyy-MM-dd''T''HH:mm:ss')}">
                            <td th:text="${#temporals.format(a.sessionDatetime, 'yyyy-MM-dd')}"></td>
                            <td th:text="${a.subject.subjectName}"></td>
                            <td th:text="${duplicateCounts.get(lessonKey)}">0</td>
                            <td>
                                <a th:href="@{/attendance/detail(
                                    subjectId=${a.subject.subjectId},
                                    datetime=${#temporals.format(a.sessionDatetime, 'yyyy-MM-dd''T''HH:mm:ss')}
                                )}">
                                    詳細
                                </a>
                            </td>
                        </th:block>
                    </tr>
                </tbody>

                <!-- 検索結果なし -->
                <tr th:if="${attendances == null or attendances.empty}">
                    <td colspan="4" class="no-data-message">該当する出席データはありません。</td>
                </tr>

            </table>
        </section>

    </main>
    
</body>
</html>