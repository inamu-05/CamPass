<section class="otp-create">
    <!-- Tailwind CSS (OTP表示エリアのスタイルに使用) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 既存のCSSとCSRFメタタグ -->
    <link rel="stylesheet" th:href="@{/css/one_time_pass.css}"> 
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <div id="header-container" th:insert="~{base/header :: header}"></div>

    <!-- 1. OTP Generation Form Card (セッション開始時に非表示にする) -->
    <div id="otp-form-card" class="otp-card">
        <h2>ワンタイムパス作成</h2>
        <div class="form-group">
            <label for="subject">科目を選択:</label>
            <select id="subject">
                <option value="">選択してください</option>
                <option th:each="s : ${subjects}" 
                        th:value="${s.subjectId}" 
                        th:text="${s.subjectName}">
                </option>
            </select>
        </div>

        <div class="result">
            <label>生成されたワンタイムパス:</label>
            <input type="text" id="generated-pass" readonly>
        </div>
    
        <div id="message-area"></div> <!-- 🔹 ここにメッセージが出る -->

        <div class="button-group">
            <button id="generate-btn" class="main-btn">パス作成</button>
            <button id="save-btn" class="sub-btn">保存/セッション開始</button>
            <button id="display-btn" class="sub-btn hidden">コード表示</button>
            <button id="back-btn" class="back-btn">戻る</button>
        </div>
    </div>
    <!-- /otp-form-card -->

    <!-- 2. OTP Display Area (Hidden until successful generation) -->
    <!-- Tailwind CSSのクラスを適用するために、元の構造を少し調整しています -->
    <div id="otp-display-container" 
         class="hidden w-full max-w-4xl mt-8 text-center p-10 rounded-xl border-4 border-teal-500 bg-teal-50 shadow-xl">
        <h2 class="text-2xl font-bold text-gray-700 mb-4">授業出席パスワード</h2>
        
        <!-- OTP Code -->
        <div class="p-4 bg-white rounded-xl shadow-inner mb-6">
            <span id="otp-code-display" class="otp-code text-teal-600">----</span>
        </div>
        
        <h3 class="text-xl font-semibold text-gray-600 mb-2">残り時間 (Expiration)</h3>
        
        <!-- Timer Display -->
        <div class="p-3 bg-white rounded-xl shadow-md inline-block min-w-[200px]">
            <span id="timer-display" class="timer-display text-red-500">05:00</span>
        </div>
        
        <p class="mt-6 text-gray-500 text-sm">パスワードは期限切れになると自動的に無効になります。画面をリフレッシュしないでください。</p>
        
        <button id="new-session-btn" 
                class="mt-8 main-btn bg-indigo-600 hover:bg-indigo-700">新規セッション開始</button>
    </div>

    <script th:src="@{/js/one_time_pass.js}" defer></script>
</section>